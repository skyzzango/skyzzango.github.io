# 제2장 CPU의 구조와 기능

* ##### CPU의 내부구조와 명령어 실행 원리 및 파이프라이닝 기술에 대해 알아보자.



## 0. CPU의 특징

-----

* 프로그램 수행이라는 컴퓨터의 기본적인 기능을 수행한다.

* 기억장치에 저장되어 있는 프로그램 코드인 명령어들을 실행한다.

* CPU의 작동 과정

  > ##### (1) 명령어 인출(Instruction fetch): 기억장치로 부터 명령어를 읽어온다.
  > ##### (2) 명령어 해독(Instruction decode): 수행해야 할 동작을 결정하기 위하여 명령어를 해독한다.
  > ##### (3) 데이터 인출(Data fetch): 명령어 실행을 위하여 데이터가 필요한 경우에는  그 데이터를 읽어온다.
  > ##### (4) 데이터 처리(Data process): 데이터에 대한 산술적 혹은 논리적 연산을 수행한다.
  > ##### (5) 데이터 저장(Data store): 수행한 결과를 저장한다.

  

* 첫 번째, 두 번째 동작들은 모든 명령어들에 대하여 공통적으로 수행된다.

* 세 번째, 네 번째, 다섯 번째 동작들은 명렁어에 따라 필요한 경우에만 수행된다.



## 1. CPU의 기본 구조

-----

* #### 산술논리연산장치(ALU: Arithmetic and Logical Unit)

  * 각종 산술 연산들과 논리 연산들을 수행하는 회로들로 이루어진 하드웨어 모듈이다.
    * 산술 연산 : 덧셈, 뺄셈, 곱셈, 나눗셈을 말한다.
    * 논리 연산 : AND, OR, NOT 연산 등이 있다.

  

* #### 레지스터 세트(Register set)

  * CPU 내부에 위치한 기억장치로서, 엑세스 속도가 컴퓨터의 기억장치들 중 가장 빠르다.
  * 내부 회로가 복잡하여 비교적 큰 공간을 차지한다.
  * 많은 수의 레지스터들을 CPU의 내부에 포함시키기 어렵다.
  * 지정된 요도로만 사용되는 특수목적용 레지스터들과 적은 수의 일반목적용 레지스트들만이 포함된다.

  

* #### 제어 유니트(Control unit)

  * 프로그램 코드(명렁어)를 해석하고, 그것을 실행하기 위한 제어 신호들(Control Signals)을 
    순차적으로 발생하는 하드웨어 모듈이다.
  * 각종 정보들의 전송 통로와 방향을 지정해주고, CPU 내부 요소들과 시스템 구성요소들의 
    동작 시간도 결정해준다.
  * CPU가 제공하는 명령어들의 수가 많아질수록 제어 유니트의 내부회로는 더 복잡해진다.
  * 복잡도를 줄이기 위하여 동작을 소프트웨어로 처리해주는 방법이 `마이크로프로그래밍`이다.
  * 하드웨어만으로 명령어를 실행할 수 있도록 하는 `RISC` 설계 개념도 많이 사용되고 있다.

  

* #### CPU 내부 버스(CPU Internal bus)

  * ALU와 레지스터들 간의 데이터 선들과 주소 선들, 제어 선들로 구성된다.
  * 내부 버스 선들은 외부의 시스템 버스와는 직접 연결되지 않는다.
  * 버퍼 레지스터 혹은 인터페이스 회로를 통하여 시스템 버스와 접속된다.



## 2. 명령어 실행

-----

* #### 명령어 사이클(Instruction cycle)

  * CPU가 한개의 명령어를 실행하는 데 필요한 전체 과정을 말한다.

  

  * ##### `명령어 인출` 단계와 `명령어 실행` 단계로 이루어진다.

    * 명령어 인출(Instruction fetch): CPU가 기억장치로부터 명령어를 읽어온다.
    * 명령어 실행(Instruction execution): 인출된 명령어를 실행한다.

    

  * `인출 사이클(Fetch cycle)`과 `실행 사이클(Execution cycle)`이라고도 부른다.

  * CPU가 프로그램 실행을 시작한 순간부터 전원을 끄거나 중단될 때가지 반복하여 수행된다.

  

  * ##### 명령어 실행을 위해 기본적으로 필요한 CPU 내부 레지스터의 종류

    * ##### 프로그램 카운터(`PC`: Program Counter)

      * 다음에 인출될 명령어의 주소를 가지고 있는 레지스터이다.

      

    * ##### 누산기(`AC`: Accumulator)

      * 데이터를 일시적으로 저장하는 레지스터이다.
      * 이 레지스터의 비트 수는 단어(word)의 길이와 같다.

      

    * ##### 명령어 레지스터(`IR`: Instruction Register)

      * 가장 최근에 인출된 명령어가 저장되어 있는 레지스터이다.

      

    * ##### 기억장치 주소 레지스터(`MAR`: Memory Address Register)

      * `PC`에 저장된 명령어 주소가 시스템 주소 버스로 출력되기 전에 일시적으로 저장되는 레지스터이다.
      * 이 레지스터의 출력 선들이 주소 버스 선들과 직접 접속된다.

      

    * ##### 기억장치 버퍼 레지스터(`MBR`: Memory Buffer Register)

      * 기억장치에 저장될 데이터 혹은 읽혀진 데이터가 일시적으로 저장되는 버퍼 레지스터이다.
      * 이 레지스터의 입력 및 출력 선들은 데이터 버스 선들과 직접 접속된다.

      

* #### 인출 사이클

  * CPU는 각 명령어 사이클의 시작 단계에서 `PC`가 가리키는 기억장치의 위치로부터 명령어를 인출해 온다.
  * 그런 다음 `PC`의 내용을 1씩 증가시킴으로써 명령어들을 저장되어 있는 순서대로 읽어올 수 있도록 한다.

  

  * ##### 마이크로-연산(Micro-operation)으로 표현

    ```elm
    t0 : MAR <- PC
    t1 : MBR <- M[MAR], PC <- PC + 1
    t2 : IR <- MBR
    
    "여기서 t0, t1, t2는 CPU 클록의 각 주기를 가리킨다."
    "첫 번째 주기: PC 내용을 내부 버스를 통하여 MAR로 보낸 뒤, 주소가 기억장치로 전송된다."
    "두 번째 주기: 읽혀진 명령어가 데이터 버스를 통해 MBR에 적재하고, PC내용에 1을 더한다."
    "세 번째 주기: MBR에 저장된 명령어 코드를 IR로 보낸다."
    ```

  

* #### 실행 사이클

  * 인출된 명령어 코드를 해독(Decode)하고, 그 결과에 따라 필요한 연산을 수행한다.

  

  * ##### CPU가 수행하는 연산들은 매우 다양한데, 크게 다음과 같이 네 가지로 분류할 수 있다.

    * ##### 데이터 이동

      * CPU와 기억장치 간 혹은 CPU와 I/O 장치 간에 데이터를 이동한다.
      * `IR`에 저장된 주소를 `MAR`을 통해 기억장치로 보내어 데이터를 인출하는 `LOAD addr`명령어

      

      * ##### 마이크로-연산(Micro-operation)으로 표현

        ```elm
        t0 : MAR <- IR(addr)
        t1 : MBR <- M[MAR]
        t2 : AC <- MBR
        
        "t0 : IR에 저장된 명령어의 주소를 MAR을 통해 기억장치로 보낸다."
        "t1 : 그 주소가 지정하는 기억장치소로부터 데이터를 인출하여 MBR에 저장한다."
        "t2 : AC레지스터에 적재한다."
        ```


​    

    * ##### 데이터 처리
    
      * 데이터에 대하여 산술 혹은 논리 연산을 수행한다.
      * 기억장치에 저장된 데이터를 `AC`레지스터의 내용과 더하고, 
        그 결과를 다시 `AC`레지스터에 저장하는 `ADD addr` 명령어


​      

      * ##### 마이크로-연산(Micro-operation)으로 표현
    
        ```elm
        t0 : MAR <- IR(addr)
        t1 : MBR <- M[MAR]
        t2 : AC <- AC + MBR
        
        "t0 : 명령어의 주소를 주소 버스를 통하여 기억장치로 보낸다."
        "t1 : 해당 기억 장소로부터 데이터를 인출하여 MBR에 적재한다."
        "t2 : 그 데이터와 AC 레지스터의 내용을 더하고, 결과값을 다시 AC 레지스터에 저장한다."
        ```


​    

    * ##### 데이터 저장
    
      * 연산결과 데이터 혹은 입력장치로부터 읽어들인 데이터를 기억장치에 저장한다.
      * `AC`레지스터의 내용을 기억장치에 저장하기 위한 `STA addr` 명령어


​      

      * ##### 마이크로-연산(Micro-operation)으로 표현
    
        ```elm
        t0 : MAR <- IR(addr)
        t1 : MBR <- AC
        t2 : M[MAR] <- MBR
        
        "t0 : 데이터를 저장할 기억 장소의 주소를 MAR로 보낸다."
        "t1 : 저장할 데이터를 MBR로 이동시킨다."
        "t2 : 주소가 지정하는 기억 장소에 데이터가 저장된다."
        ```


​    

    * ##### 프로그램 제어
    
      * 프로그램의 실행 순서를 결정한다.
      * 프로그램 실행 순서를 바꾸도록 해주는 분기(Branch) 명령어 중 `JUMP addr` 명령어


​      

      * ##### 마이크로-연산(Micro-operation)으로 표현
    
        ```elm
        t0 : PC <- IR(addr)
        
        "t0 : 분기 목적지 주소(Branch target address)를 PC로 적재한다."
        ```


​      


* #### 인터럽트 사이클





